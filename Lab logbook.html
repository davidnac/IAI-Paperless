<html>
    <header>
        <title>Items managment</title>
          <!-- Font Awesome icons (free version)-->
        <script src="https://use.fontawesome.com/releases/v5.15.1/js/all.js" crossorigin="anonymous"></script>

        <!-- Bootstrap CSS -->
        <link rel="stylesheet" href="https://www.markuptag.com/bootstrap/5/css/bootstrap.min.css" />

        <style>
            @import url(&#39;https://fonts.googleapis.com/css2?family=Montserrat:wght@300&amp;display=swap&#39;);

                html{
                    margin: 0;
                    padding: 0;
                    background-color: #f6f7fb;
                    height: 100%;
                    font-family: 'Montserrat', sans-serif;
                }
                body{
                    min-height: 100%;
                    padding: 20px;
                    text-transform: uppercase;
                }
                
                .table-box{
                    margin: 50px auto;
                }
                .table-row{
                    background-color: white;
                    border-radius: 5px;
                    display: table;
                    width: 80%;
                    margin: 6px auto;
                    padding: 12px;
                    color: #555;
                    font-size: 14px;
                    box-shadow: 0 1px 4px 0 rgba(0, 0, 50, 0.3);
                }
                .table-row.item:hover{
                    cursor: pointer;
                    background-color: #71DFE7;
                }
                .table-cell{
                    display: table-cell;
                    text-align: start;
                    padding: 4px 0;
                    border-right: 1px solid black;
                    vertical-align: middle;
                    background-color: inherit;
                }

                .table-head{
                    background-color: #396EB0;
                    box-shadow: none;
                    color: white;
                    font-weight: 600;
                }

                .table-head .table-cell{
                    border-right: none;
                }

                p{
                    background-color: inherit;
                }
                /*-----------------*/

                .styled-table {
                border-collapse: collapse;
                margin: 25px;
                font-size: 0.85rem;
                width: 96%;
                border-radius: 7px 7px 0 0;
                overflow: hidden;
                box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
                background-color: white;

              }

              .styled-table thead th {
              background-color: #D9534F;
              color: #ffffff;
              text-align: start;
              text-transform: uppercase;
             }


              .styled-table tbody tr{
              background-color: white;
             }

             .styled-table tr th,
            .styled-table td {
             padding: 15px 20px;
             text-align: center;
            }

            tr td{
                background-color: inherit;
            }

            #itemsTable tr > td:last-of-type {
            font-weight: bold;
            font-style: italic;
            color: #2F3A8F;
            letter-spacing: 1px;
            }

            .styled-table tbody tr {
               border-bottom: 3px solid #dddddd;
              
            }

            /*
            .styled-table tbody tr:nth-of-type(even) {
                background-color: #f3f3f3;
            }*/

            .styled-table tbody tr:last-of-type {
                border-bottom: 2px solid #D9534F;
            }

            .styled-table tbody tr.active-row {
                font-weight: bold;
                color: black;
                background-color: #f6f7fb;
                border-left: 8px solid #D9534F;
            }

            .styled-table tbody tr:hover{
                background-color: #d6d3d2;
                cursor: pointer;
            }

            .status-finished{
                color: #29ab87;
                font-weight: bold;
            }
            .status-running{
                color: orange;
                font-weight: bold;
            }
            .status-failed{
                color: #cd5c5c;
                font-weight: bold;
            }
            /*-------------------*/
            .top-bar{
                margin-bottom: 16px;
                margin-left: 25px;
                display: flex;
                flex-direction: row;
                justify-content: space-between;
                width: 96%;
            }

            .input-container{
                width: 100%;
                margin-right: 30px;
            }

            input{
                width: 400px;
                height: 40px;
                border-radius: 3px;
                font-size: 14px; 
                padding: 12px 20px 12px 20px; 
                border: 1px solid #D9534F; 
            }

            .buttons{
                display: flex;
                flex-direction: row;
                vertical-align: middle;
                align-items: center;
            }

            .buttons a{
                margin: 8px 0 8px 18px;
                text-decoration: none;
                color: #D9534F;
                font-size: 15px;    
                font-weight: bold;
            }

            .buttons a:hover{
                color: #9B0000;   
            }

            /*-----------------*/

            .card-container{
                height: 90%;
                display: flex;
                padding-bottom: 0;
                }

              

                .card-container .items-container{
                width: 100%;
               /* height: 100%;
                overflow-y: auto;*/
                }

               .projects table{
                   margin-top: 34px;
                   width: 90%;
               }

               .projects table thead th {
                background-color: #1DE9B6;
                color: black;
               }

               .projects table tbody tr:last-of-type {
                border-bottom: 2px solid #1DE9B6;
               }

             
                .projects-header{
                display: flex;
                flex-direction: row;
                justify-content: space-between;
                font-size: 20px;
                vertical-align: middle;
               }

               .projects-header p{
                margin: 0;
                font-size: 15px;
                font-weight: bold;
                vertical-align: middle;
               }

               .projects-header a{
                color: black;
                text-decoration: none;
               }

               .projects-header a:hover{
                cursor: pointer;
                color: white;
               }

              
               .fixTableHead {
                overflow-y: auto;
                height: 100%;
                }

                .header-container{
                display: flex;
                flex-direction: row;
                justify-content: space-between;
                }

                .header-container p{
                  margin: 0;
                  display: inline-block;
                }

                .header-container:hover{
                 cursor: pointer;
                 color: black;
                }


               .modal-btn-stack{
                   display: flex;
                   flex-direction: row;
                   justify-content: end;
               }

               .wide-form{
                   display: flex;
                   flex-direction: row;
                   width: 100%;
               }

               .wide-form input, .wide-form textarea{
                   width: 350px;
               }

               .wide-form label{
                   font-size: 13px;
                   color: #D9534F;
               }

               /*-------------------------------*/

               .exportBtn{
                    color: #D9534F;
                    font-size: 15px;
                    font-weight: 700;
                    background-color: transparent;
                    border: none;
                    margin-left: 10px;
               }

               .exportBtn:hover{
                color: #9B0000;  
               }

            /*--------------custom input file-------------------*/
              .custom-file-input {
                  color: transparent;
                  border: none;
                  max-height: 40px;
}
.custom-file-input::-webkit-file-upload-button {
  visibility: hidden;
}
.custom-file-input::before {
  content: 'IMPORT';
  color: #D9534F;
  display: inline-block;
  border: none;
  border-radius: 3px;
  padding: 5px 8px;
  outline: none;
  white-space: nowrap;
  -webkit-user-select: none;
  cursor: pointer;
  text-shadow: 1px 1px #fff;
  font-weight: 700;
  font-size: 15px;
}
.custom-file-input:hover::before {
  color: #9B0000;
}
.custom-file-input:active {
  outline: 0;
}
.custom-file-input:active::before {
  background: -webkit-linear-gradient(top, #e3e3e3, #f9f9f9); 
}

             /*--------------custom input file-------------------*/     
    
        </style>

    </header>
    <body>

  <div class="card-container">
        
  
    
<div class="items-container">

    <div class="top-bar">
 
        <div>
            <input type="text" id="myInput" onkeyup="searchTable()" placeholder="Search...">
            <button class="exportBtn" onclick="exportData()">EXPORT</button> 
           
            <input type="file" id="myFile" name="myFile" onchange="readCsvFile()"  class="custom-file-input">
        </div>
        

        <div class="buttons">
            <a href='' id="editBtn">Edit</a>
            <a href='' id="deleteBtn">Delete</a>
            <a href='' id="closeBtn">Close</a>
            <a data-bs-target="#modalForm" data-bs-toggle="modal" href=''>Add work</a>
        </div>
    </div>
    
    
    <div class="fixTableHead">
        <table class="styled-table" id="itemsTable">
            <thead>
                <tr>
                     <th>
                      <div class="header-container">
                        <p>Work number</p>
                        <i class="fas fa-sort-down"></i>
                      <div>
                    </th>
                       <th>
                      <div class="header-container">
                        <p>Start date</p>
                        <i class="fas fa-sort-down"></i>
                      <div>
                    </th>
                       <th>
                      <div class="header-container">
                        <p>Finish date</p>
                        <i class="fas fa-sort-down"></i>
                      <div>
                    </th>
                    <th>
                        <div class="header-container">
                          <p>Work order</p>
                          <i class="fas fa-sort-down"></i>
                        <div>
                      </th>
                   
                     <th>
                      <div class="header-container">
                        <p>Operator</p>
                        <i class="fas fa-sort-down"></i>
                      <div>
                    </th>
                   <th>
                      <div class="header-container">
                        <p>Part name/number</p>
                        <i class="fas fa-sort-down"></i>
                      <div>
                    </th>
                    <th>
                      <div class="header-container">
                        <p>Quantity</p>
                        <i class="fas fa-sort-down"></i>
                      <div>
                    </th>
                    <th>
                      <div class="header-container">
                        <p>Engine name</p>
                        <i class="fas fa-sort-down"></i>
                      <div>
                    </th>
                    <th>
                      <div class="header-container">
                        <p>Work type</p>
                        <i class="fas fa-sort-down"></i>
                      <div>
                    </th>
                 
                     <th>
                      <div class="header-container">
                        <p>Customer dept.</p>
                        <i class="fas fa-sort-down"></i>
                      <div>
                    </th>

                     <th>
                      <div class="header-container">
                        <p>Comments</p>
                        <i class="fas fa-sort-down"></i>
                      <div>
                    </th>

                    <th>
                      <div class="header-container">
                        <p>Signature</p>
                        <i class="fas fa-sort-down"></i>
                      <div>
                    </th>
                   
                </tr>
            </thead>
            <tbody>
               
               
            </tbody>
        </table>
    </div>     
</div>
</div>



<!-- Modal add part-->
<div class="modal fade" id="modalForm" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Add new work</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body extra-wide">
                <form class="wide-form">
                    <div class="left col-6">
                        <div class="mb-3">
                            <label class="form-label">Work order</label>
                            <input type="text" class="form-control" id="username" name="username" placeholder="work order" style="text-transform:uppercase"/>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Operator</label>
                            <input type="text" class="form-control" id="password" name="password" placeholder="operator" style="text-transform:uppercase"/>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Part details</label>
                            <input type="text" class="form-control" id="password" name="password" placeholder="part details" style="text-transform:uppercase"/>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Quantity</label>
                            <input type="text" class="form-control" id="password" name="password" placeholder="quantity" style="text-transform:uppercase"/>
                        </div>
                    </div>

                    <div class="right col-6">
                        <div class="mb-3">
                            <label class="form-label">Comments</label>
                            <textarea class="form-control instruction-box" placeholder="Write something" name="comments" cols="40" rows="3"></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Engine</label>
                            <input type="text" class="form-control" id="password" name="password" placeholder="Engine name" style="text-transform:uppercase"/>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Work type</label>
                            <input type="text" class="form-control" id="password" name="password" placeholder="Metallography.." style="text-transform:uppercase"/>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Customer</label>
                            <input type="text" class="form-control" id="password" name="password" placeholder="customer" style="text-transform:uppercase"/>
                        </div>
                        <div class="modal-footer  modal-btn-stack">
                            <button type="submit" class="btn btn-danger float-start">Scan barcode</button>
                            <button  class="btn btn-primary float-end" onclick="insertData()">Add</button>
                        </div>
                    </div>
                  
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Modal add part-->
<!--
<div class="modal fade" id="modalForm" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Add new part</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="mb-3">
                        <label class="form-label">Part number</label>
                        <input type="text" class="form-control" id="partnumber" name="partnumber" placeholder="Part number" style="text-transform:uppercase"/>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Part serial</label>
                        <input type="text" class="form-control" id="partserail" name="partserial" placeholder="For batch insert a range" style="text-transform:uppercase"/>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Engine type</label>
                        <input type="text" class="form-control" id="enginetype" name="enginetype" placeholder="Engine type" style="text-transform:uppercase"/>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Engine serial</label>
                        <input type="text" class="form-control" id="engineserial" name="engineserial" placeholder="Engine serial" style="text-transform:uppercase"/>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Set Route card</label>
                        <input type="text" class="form-control" id="routecard" name="routecard" placeholder="e.g 11244323" style="text-transform:uppercase"/>
                    </div>
                    <div class="modal-footer d-block">
                        <button  class="btn btn-danger float-start">Scan barcode</button>
                        <button  class="btn btn-primary float-end" onclick="insertData()">Add</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
-->

<!-- Modal add project-->
<div class="modal fade" id="modalProject" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Create new project</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="mb-3">
                        <label class="form-label">Project name</label>
                        <input type="text" class="form-control" id="username" name="username" placeholder="Project name" style="text-transform:uppercase"/>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Project engine</label>
                        <input type="text" class="form-control" id="password" name="password" placeholder="Engine name" style="text-transform:uppercase"/>
                    </div>
                       <div class="mb-3">
                        <label class="form-label">Customer</label>
                        <input type="text" class="form-control" id="password" name="password" placeholder="e.g U.S Air force" style="text-transform:uppercase"/>
                    </div>
                    <div class="modal-footer d-block">
                        <button type="submit" class="btn btn-primary float-end">Create project</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Modal edit project-->
<div class="modal fade" id="modalProjectEdit" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Edit project</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="mb-3">
                        <label class="form-label">Project name</label>
                        <input type="text" class="form-control" id="username" name="username" placeholder="Project name" style="text-transform:uppercase"/>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Project engine</label>
                        <input type="text" class="form-control" id="password" name="password" placeholder="Engine name" style="text-transform:uppercase"/>
                    </div>
                     <div class="mb-3">
                        <label class="form-label">Customer</label>
                        <input type="text" class="form-control" id="password" name="password" placeholder="e.g U.S Air force" style="text-transform:uppercase"/>
                    </div>
                    <div class="modal-footer d-block">
                        <button type="submit" class="btn btn-danger float-start">Delete project</button>
                        <button type="submit" class="btn btn-primary float-end">Save changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap JS -->
<script src="https://www.markuptag.com/bootstrap/5/js/bootstrap.bundle.min.js"></script>

<script>
var index;
var highlightedRow=-1;
var partsTable = document.getElementById("itemsTable");
var rows = document.getElementById("itemsTable").rows;
const editBtn = document.querySelector('#editBtn');   
const deleteBtn = document.querySelector('#deleteBtn');
const closeBtn = document.querySelector('#closeBtn');   
const addModal = document.querySelector('#modalForm'); 
var checkboxWo = document.querySelector("#checkboxWo");
var checkboxRc = document.querySelector("#checkboxRc");
var checkboxEngine = document.querySelector("#checkboxEngine");
var checkboxPart = document.querySelector("#checkboxPart");
var checkboxFinished = document.querySelector("#checkboxFinished");
var checkboxProcess = document.querySelector("#checkboxProcess");
var checkboxFailed = document.querySelector("#checkboxFailed");
//var checkboxRefrence = document.querySelector("#checkboxRefrence");
//var checkboxOperation = document.querySelector("#checkboxOperation");
var dataAttribute;
var filtersAray = [0,1,2,3,4,5,6];
var checkboxsAray = [checkboxWo,checkboxRc,checkboxEngine,checkboxPart,checkboxFinished,checkboxProcess,checkboxFailed];
const initialWorkNumber = 98367;
let lastWorkNumber;


toggleVisibilty(true);
populateInitTable();
//exportData();
    

function toggleVisibilty(hidden){
    if(hidden){
        editBtn.style.display = "none";
        deleteBtn.style.display = "none";
        closeBtn.style.display = "none";
    }else{
        editBtn.style.display = "initial";
        deleteBtn.style.display = "initial";
        closeBtn.style.display = "initial";

    }
}





function addRowHandlers() {
    
    for (i = 0; i < rows.length; i++) {

         rows[i].addEventListener('click', function (e) {
            
            var a = event.target.parentNode;
            if(!a.classList.contains("active-row")){
                clearRows();
                a.classList.add("active-row");
                toggleVisibilty(false);
                highlightedRow = a.rowIndex;
            }else{
                clearRows();
                toggleVisibilty(true);
                highlightedRow = -1;
            }

         });
    }
}

function clearRows(){
    for (i = 0; i < rows.length; i++) {
        rows[i].classList.remove("active-row");
    }
}

window.onload = addRowHandlers();

function searchTable() {
  // Declare variables
  var input, filter, tr, td, i, txtValue;
  input = document.getElementById("myInput");
  filter = input.value.toUpperCase();
  tr = partsTable.getElementsByTagName("tr");
  cols = partsTable.getElementsByTagName("th");
  
        //check row
        for (i = 1; i < tr.length; i++) {
            td = tr[i];
            if (td) {
            txtValue = td.textContent || td.innerText;
            if (txtValue.toUpperCase().indexOf(filter) > -1) {
                tr[i].style.display = "";
            } else {
                tr[i].style.display = "none";
            }
        }
    }
  
}


function populateInitTable(){
    var dataArray = [
                    ['73862',getCurrentDate(),'13/06/2021','178637343','David nachmani','2A2718-01','3','PW4000','Hardness','1234','-','Signature'],
                    ['73863','13/06/2021','13/06/2021','178637343','David nachmani','2A2718-01','3','PW4000','Metallography','1883','-','Signature'],
                    ['73864','13/06/2021','13/06/2021','178637343','David nachmani','2A2718-01','3','PW4000','Metallography','1824','-','Signature'],
                    ['73865','13/06/2021','13/06/2021','178637343','David nachmani','2A2718-01','3','PW4000','Metallography','1824','-','Signature'],
                    ['73866','13/06/2021','13/06/2021','178637343','David nachmani','2A2718-01','3','PW4000','Tensile','1824','-','Signature'],
                    ['73867','13/06/2021','13/06/2021','178637343','David nachmani','2A2718-01','3','PW4000','Hardness','DHL','-','Signature'],
                    ['73868','13/06/2021','13/06/2021','178637343','David nachmani','2A2718-01','3','PW4000','Hardness','DHL','-','Signature'],
                    ['73869','13/06/2021','13/06/2021','178637343','David nachmani','2A2718-01','3','PW4000','Hardness','1234','-','Signature'],
                    ['73870','13/06/2021','13/06/2021','178637343','David nachmani','2A2718-01','3','PW4000','Hardness','1234','-','Signature'],
                    ['73871','13/06/2021','13/06/2021','178637343','David nachmani','2A2718-01','3','PW4000','Hardness','1883','-','Signature'],
                    ['73875','13/06/2021','13/06/2021','178637343','David nachmani','2A2718-01','3','PW4000','Tensile','1824','-','Signature'],
                    ['73876','13/06/2021','13/06/2021','178637343','David nachmani','2A2718-01','3','PW4000','Metallography','1824','-','Signature'],
                    ['73877',getCurrentDate(),'13/06/2021','178637343','David nachmani','2A2718-01','3','PW4000','Hardness','1883','-','Signature']
           
                    ];
        for(var i=0;i<dataArray.length;i++){  
            lastWorkNumber = initialWorkNumber+i;
            dataArray[i][0] = lastWorkNumber.toString();
            addRow(dataArray[i]) 
       }      
       console.log(lastWorkNumber)       
}

function setColorToStatusColumn(){
    //need to do
}

function insertData(){
   const vc = addModal.querySelector('#routecard').textContent
   const pn = addModal.querySelector('#partnumber').textContent
   const ps = addModal.querySelector('#partserail').textContent
   const es = addModal.querySelector('#engineserial').textContent
   const et = addModal.querySelector('#enginetype').textContent
   
   inputValuesArray = ['123456',vc,'disk turbine',pn,ps,et,es,'01/2/22','IN WORK'];
   addRow(inputValuesArray)
}

function addRow(inputValuesArray) {
  //var inputValuesArray = ['1111','234','disk','hf383','serial','f100','hjhds','12.2.2','start'];
  var row = partsTable.querySelector('tbody').insertRow(0);
  for(var i=0; i<inputValuesArray.length; i++){
    row.insertCell(i).textContent = inputValuesArray[i];
   
  }
}


function deleteRow(highlightedRow) {
    console.log(highlightedRow)
    if(highlightedRow>0){
        partsTable.deleteRow(highlightedRow);
    }
}

deleteBtn.addEventListener("click", function(event){
  event.preventDefault() //default reloads page
  deleteRow(highlightedRow)
});

function getCurrentDate(){
    var today = new Date();
    var dd = String(today.getDate()).padStart(2, '0');
    var mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!
    var yyyy = today.getFullYear();

    today = dd + '/' + mm + '/' + yyyy;
    return today;
}

function exportData(){

 var dataArray = [
                    ['73862',getCurrentDate(),'13/06/2021','178637343','David nachmani','2A2718-01','3','PW4000','Hardness','1234','-','Signature'],
                    ['73863','13/06/2021','13/06/2021','178637343','David nachmani','2A2718-01','3','PW4000','Metallography','1883','-','Signature'],
                    ['73864','13/06/2021','13/06/2021','178637343','David nachmani','2A2718-01','3','PW4000','Metallography','1824','-','Signature'],
                    ['73865','13/06/2021','13/06/2021','178637343','David nachmani','2A2718-01','3','PW4000','Metallography','1824','-','Signature'],
                    ['73866','13/06/2021','13/06/2021','178637343','David nachmani','2A2718-01','3','PW4000','Tensile','1824','-','Signature'],
                    ['73867','13/06/2021','13/06/2021','178637343','David nachmani','2A2718-01','3','PW4000','Hardness','DHL','-','Signature'],
                    ['73868','13/06/2021','13/06/2021','178637343','David nachmani','2A2718-01','3','PW4000','Hardness','DHL','-','Signature'],
                    ['73869','13/06/2021','13/06/2021','178637343','David nachmani','2A2718-01','3','PW4000','Hardness','1234','-','Signature'],
                    ['73870','13/06/2021','13/06/2021','178637343','David nachmani','2A2718-01','3','PW4000','Hardness','1234','-','Signature'],
                    ['73871','13/06/2021','13/06/2021','178637343','David nachmani','2A2718-01','3','PW4000','Hardness','1883','-','Signature'],
                    ['73875','13/06/2021','13/06/2021','178637343','David nachmani','2A2718-01','3','PW4000','Tensile','1824','-','Signature'],
                    ['73876','13/06/2021','13/06/2021','178637343','David nachmani','2A2718-01','3','PW4000','Metallography','1824','-','Signature'],
                    ['73877',getCurrentDate(),'13/06/2021','178637343','David nachmani','2A2718-01','3','PW4000','Hardness','1883','-','Signature']
           
                    ];

 
    /* Declaring array variable */
    var rows =[];
    var singleRow = [];
    const numOfColumns = partsTable.rows[0].cells.length 

    for(var i=0; i< partsTable.rows.length ;i++){
            singleRow = [];
            for(var j=0; j<numOfColumns; j++){ 
                singleRow.push(partsTable.rows[i].cells[j].innerText)
            }
            rows.push(singleRow);
        }   

        csvContent = "data:text/csv;charset=utf-8,";
         /* add the column delimiter as comma(,) and each row splitted by new line character (\n) */
         /* switched dataArray with dataArray */
         rows.forEach(function(rowArray){
            row = rowArray.join(",");
            csvContent += row + "\r\n";
        });
 
        /* create a hidden <a> DOM node and set its download attribute */
        var encodedUri = encodeURI(csvContent);
        var link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", "Stock_Price_Report.csv");
        document.body.appendChild(link);
         /* download the data file named "Stock_Price_Report.csv" */
        link.click();
}


function readCsvFile() {
    var fileSize = 0;
    //get file
    var theFile = document.getElementById("myFile");
   console.log("got file")
    
     var regex = /^([a-zA-Z0-9\s_\\.\-:])+(.csv|.txt)$/;
     //check if file is CSV
     if (regex.test(theFile.value.toLowerCase())) {
      console.log("file is csv")
     //check if browser support FileReader
        if (typeof (FileReader) != "undefined") {
      console.log("support browser")
        var headerLine = "";
        //create html5 file reader object
        var myReader = new FileReader();
        // call filereader. onload function
        myReader.onload = function(e) {
            var content = myReader.result;
            //split csv file using "\n" for new line ( each row)
            var lines = content.split("\r");
            //loop all rows
            for (var count = 0; count < lines.length; count++) {
                //create a tr element
                var row = document.createElement("tr");
                //split each row content
                var rowContent = lines[count].split(",");
                //loop throw all columns of a row
                for (var i = 0; i < rowContent.length; i++) {
                   //create td element 
                    var cellElement = document.createElement("td");
                    if (count == 0) {
                        cellElement = document.createElement("th");
                    } else {
                        cellElement = document.createElement("td");
                    }
                    //add a row element as a node for table
                    var cellContent = document.createTextNode(rowContent[i]);
                    
                    cellElement.appendChild(cellContent);
                    //append row child
                    row.appendChild(cellElement);
                }
                //append table contents
                partsTable.appendChild(row);
            }
        }
         //call file reader onload
          myReader.readAsText(theFile.files[0]);
        }
        else 
        {
              alert("This browser does not support HTML5.");
        }
        
    }
    else {
                alert("Please upload a valid CSV file.");
    }
    return false;
}


</script>
        
    </body>
</html>